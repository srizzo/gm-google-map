angular.module("gm-google-map",[]).directive("gmMapContext",function(){return{restrict:"EA",controller:function(a){var b;a.setMap=function(a){b=a},this.getMap=function(){return b},a.getMap=function(){return b}}}}).directive("gmMapCanvas",function(){return{restrict:"EA",require:"^?gmMapContext",link:{pre:function(a,b,c){var d=new google.maps.Map(b.get(0),{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{draggable:!1}]});window.Map=d,a.setMap&&a.setMap(d),c.gmZoom&&a.$watch(c.gmZoom,function(a){d.setZoom(a)}),c.gmCenter&&a.$watch(c.gmCenter,function(a){null!=a&&d.setCenter(new google.maps.LatLng(a.lat,a.lng))}),a.safeApply=function(b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&"function"==typeof b&&b():a.$apply(b)},angular.forEach(a.$eval(c.gmListeners),function(b,c){google.maps.event.addListener(d,c,function(){a.safeApply(function(){b()})})}),angular.forEach(a.$eval(c.gmListenersOnce),function(b,c){google.maps.event.addListenerOnce(d,c,function(){a.safeApply(function(){b()})})})}}}}).directive("gmControls",function(){return{scope:!1,require:"^gmMapContext",compile:function(a){a.hide()}}}).directive("gmControl",function(){return{scope:!0,compile:function(a,b){return"undefined"==typeof b.gmVisible&&(b.gmVisible="true"),{pre:function(a,b,c){var d=b.get(0),e=a.getMap(),f=c.gmPosition||"LEFT_TOP";a.hide=function(){var a=e.controls[google.maps.ControlPosition[f]].indexOf(d);a>-1&&e.controls[google.maps.ControlPosition[f]].removeAt(a)},a.show=function(){var a=e.controls[google.maps.ControlPosition[f]].indexOf(d);0>a&&e.controls[google.maps.ControlPosition[f]].push(d)},a.$watch(c.gmVisible,function(b){b===!0?a.show():a.hide()})}}}}}).directive("gmInfoWindow",function(){return{require:"^gmMapContext",link:function(a,b,c){var d=b.get(0),e=new google.maps.InfoWindow;e.setContent(d),c.closeclick&&e.addListener("closeclick",function(){a.$apply(function(){a.$eval(c.closeclick)})}),a.open=function(b){e.open(a.getMap(),b)},a.close=function(){e.close()}}}}).directive("gmOverlappingMarkerSpiderfier",function(){return{restrict:"AE",require:"^gmMapContext",link:function(a,b,c){b.hide();var d=new OverlappingMarkerSpiderfier(a.getMap(),{keepSpiderfied:!0});a.$on("marker_created",function(a,b){d.addMarker(b)}),a.$on("marker_destroyed",function(a,b){d.removeMarker(b)}),d.addListener("click",function(b){a.$apply(function(){a.$eval(c.gmClick,{marker:b})})})}}}).directive("gmMarker",function(){return{restrict:"AE",require:"^gmMapContext",link:function(a,b,c){var d=new google.maps.Marker({map:a.getMap(),data:a.$eval(c.gmData),title:a.$eval(c.gmTitle),optimized:a.$eval(c.gmOptimized),position:new google.maps.LatLng(a.$eval(c.gmLat),a.$eval(c.gmLng))}),e=a.$watch(c.gmIcon,function(a){d.setIcon(a)});a.$emit("marker_created",d),a.$on("$destroy",function(){e(),d.setMap(null),a.$emit("marker_destroyed",d)})}}});